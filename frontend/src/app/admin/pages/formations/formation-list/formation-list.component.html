<div class="container-fluid">
  <app-pagetitle
    title="List of Formation"
    [breadcrumbItems]="breadCrumbItems"
  ></app-pagetitle>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="row mb-md-2">
            <div class="col-sm-12 col-md-6">
              <div class="dataTables_length" id="tickets-table_length">
                <label class="d-inline-flex align-items-center"
                  >Show
                  <select
                    name="tickets-table_length"
                    aria-controls="tickets-table"
                    name="pageSize"
                    [(ngModel)]="service.pageSize"
                    class="custom-select custom-select-sm form-control form-control-sm mx-2"
                  >
                    <option [ngValue]="10">10</option>
                    <option [ngValue]="25">25</option>
                    <option [ngValue]="50">50</option>
                    <option [ngValue]="100">100</option>
                  </select>
                  entries</label
                >
              </div>
            </div>
            <!-- Search -->
            <div class="col-sm-12 col-md-6">
              <div
                id="tickets-table_filter"
                class="dataTables_filter text-md-end"
              >
                <label class="d-inline-flex align-items-center"
                  >Search:
                  <input
                    type="text"
                    name="searchTerm"
                    class="form-control form-control-sm ms-2"
                    aria-controls="tickets-table"
                    [(ngModel)]="service.searchTerm"
                /></label>
              </div>
            </div>
            <!-- End search -->
          </div>
          <!-- Table -->
          <div>
            <table
              id="basic-datatable"
              class="table table-bordered dt-responsive nowrap datatables no-footer dtr-inline"
            >
              <thead>
                <tr>
                  <th></th>
                  <th sortable="title" (sort)="onSort($event)">
                    Title
                    <ng-container *ngIf="headers.length">
                      <i
                        *ngIf="headers.get(0)?.direction === 'asc'"
                        class="fas fa-arrow-up"
                      ></i>
                      <i
                        *ngIf="headers.get(0)?.direction === 'desc'"
                        class="fas fa-arrow-down"
                      ></i>
                    </ng-container>
                  </th>
                  <th sortable="category" (sort)="onSort($event)">
                    Category
                    <ng-container *ngIf="headers">
                      <i
                        *ngIf="headers.get(1)?.direction === 'asc'"
                        class="fas fa-arrow-up"
                      ></i>
                      <i
                        *ngIf="headers.get(1)?.direction === 'desc'"
                        class="fas fa-arrow-down"
                      ></i>
                    </ng-container>
                  </th>
                  <th sortable="city" (sort)="onSort($event)">
                    City
                    <ng-container *ngIf="headers">
                      <i
                        *ngIf="headers.get(2)?.direction === 'asc'"
                        class="fas fa-arrow-up"
                      ></i>
                      <i
                        *ngIf="headers.get(2)?.direction === 'desc'"
                        class="fas fa-arrow-down"
                      ></i>
                    </ng-container>
                  </th>
                  <th sortable="nb_hours" (sort)="onSort($event)">
                    Nb Hours
                    <ng-container *ngIf="headers">
                      <i
                        *ngIf="headers.get(3)?.direction === 'asc'"
                        class="fas fa-arrow-up"
                      ></i>
                      <i
                        *ngIf="headers.get(3)?.direction === 'desc'"
                        class="fas fa-arrow-down"
                      ></i>
                    </ng-container>
                  </th>
                  <th sortable="cost" (sort)="onSort($event)">
                    Cost
                    <ng-container *ngIf="headers">
                      <i
                        *ngIf="headers.get(4)?.direction === 'asc'"
                        class="fas fa-arrow-up"
                      ></i>
                      <i
                        *ngIf="headers.get(4)?.direction === 'desc'"
                        class="fas fa-arrow-down"
                      ></i>
                    </ng-container>
                  </th>
                  <th sortable="start_registration" (sort)="onSort($event)">
                    Start Registation Date
                    <ng-container *ngIf="headers">
                      <i
                        *ngIf="headers.get(5)?.direction === 'asc'"
                        class="fas fa-arrow-up"
                      ></i>
                      <i
                        *ngIf="headers.get(5)?.direction === 'desc'"
                        class="fas fa-arrow-down"
                      ></i>
                    </ng-container>
                  </th>
                  <th sortable="end_registration" (sort)="onSort($event)">
                    End Registation Date
                    <ng-container *ngIf="headers">
                      <i
                        *ngIf="headers.get(6)?.direction === 'asc'"
                        class="fas fa-arrow-up"
                      ></i>
                      <i
                        *ngIf="headers.get(6)?.direction === 'desc'"
                        class="fas fa-arrow-down"
                      ></i>
                    </ng-container>
                  </th>
                  <th sortable="status" (sort)="onSort($event)">
                    Status
                    <ng-container *ngIf="headers">
                      <i
                        *ngIf="headers.get(7)?.direction === 'asc'"
                        class="fas fa-arrow-up"
                      ></i>
                      <i
                        *ngIf="headers.get(7)?.direction === 'desc'"
                        class="fas fa-arrow-down"
                      ></i>
                    </ng-container>
                  </th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody *ngFor="let formation of tables$ | async; let i = index">
                <tr>
                  <td class="text-center">
                    <img
                      src="{{ formation.photo }}"
                      alt="image"
                      class="avatar-sm"
                    />
                  </td>
                  <!-- <td align="center">
                    <a class="expand-row" (click)="changeValue(i)">
                      +
                    </a>
                  </td> -->
                  <td class="align-middle">
                    <ngb-highlight
                      [result]="formation.title"
                      [term]="service.searchTerm"
                    ></ngb-highlight>
                  </td>
                  <td class="align-middle">
                    <ngb-highlight
                      [result]="formation.category"
                      [term]="service.searchTerm"
                    ></ngb-highlight>
                  </td>
                  <td class="align-middle">
                    <ngb-highlight
                      [result]="formation.city"
                      [term]="service.searchTerm"
                    ></ngb-highlight>
                  </td>
                  <td class="align-middle">
                    <ngb-highlight
                      [result]="formation.nb_hours.toString()"
                      [term]="service.searchTerm"
                    ></ngb-highlight>
                  </td>
                  <td class="align-middle">
                    <ngb-highlight
                      [result]="formation.cost.toString() + ' DH'"
                      [term]="service.searchTerm"
                    ></ngb-highlight>
                  </td>
                  <td class="align-middle">
                    <ngb-highlight
                      [result]="formation.start_registration.toString()"
                      [term]="service.searchTerm"
                    ></ngb-highlight>
                  </td>
                  <!--dates-->
                  <td class="align-middle">
                    <ngb-highlight
                      [result]="formation.end_registration.toString()"
                      [term]="service.searchTerm"
                    ></ngb-highlight>
                  </td>

                  <td class="align-middle">
                    <div
                      class="badge font-size-12"
                      [ngClass]="{
                        'bg-danger-subtle text-danger':
                          formation.status === 'INACTIVE',
                        'bg-success-subtle text-success':
                          formation.status === 'ACTIVE'
                      }"
                    >
                      {{ formation.status }}
                    </div>
                    <!-- <ngb-highlight [result]="formation.status" [term]="service.searchTerm"></ngb-highlight> -->
                  </td>
                  <td class="align-middle">
                    <div ngbDropdown placement="bottom-left">
                      <i
                        class="mdi mdi-dots-vertical dropdown-toggle"
                        ngbDropdownToggle
                        data-toggle="dropdown"
                        aria-expanded="true"
                      ></i>
                      <div
                        class="dropdown-menu dropdown-menu-end"
                        ngbDropdownMenu
                      >
                        <a
                          class="dropdown-item"
                          [routerLink]="[
                            '/dashboard/formations/update/',
                            formation.id
                          ]"
                          ><i class="mdi mdi-account-edit"></i>Edit</a
                        >
                        <a
                          class="dropdown-item"
                          (click)="deleteFormation(formation.id)"
                          href="javascript: void(0);"
                          ><i class="mdi mdi-delete-outline"></i>Delete</a
                        >
                      </div>
                    </div>
                  </td>
                </tr>
                <!-- <tr *ngIf="!hideme[i]" class="sub-table no-bg">
                  <td align="center"> </td>
                  <td colspan="15" class="p-0">
                    <table class="table mb-0 table-striped">
                      <thead>
                        <tr>
                          <th>Email</th>
                          <th>Phone</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>{{formation.email}}</td>
                          <td>{{formation.phone}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                </tr> -->
              </tbody>
              <!-- if the table is empty -->
              <tbody
                *ngIf="
                  (tables$ | async)?.length === 0 && !(service.loading$ | async)
                "
              >
                <tr>
                  <td colspan="9" style="text-align: center">
                    No formation found
                  </td>
                </tr>
              </tbody>

              <!-- if the table is loading -->
              <ng-container *ngIf="service.loading$ | async">
                <tr>
                  <td colspan="9" style="text-align: center">
                    <div class="spinner-border text-primary m-1" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                  </td>
                </tr>
              </ng-container>
            </table>
          </div>
          <!-- End table -->
          <div
            class="row justify-content-md-between align-items-md-center mt-2"
          >
            <div class="col-sm-12 col-md-5">
              <div
                class="dataTables_info mb-2"
                id="tickets-table_info"
                role="status"
                aria-live="polite"
              >
                Showing {{ service.startIndex }} to {{ service.endIndex }} of
                {{ service.totalRecords }}
                entries
              </div>
            </div>
            <!-- Pagination -->
            <div class="col-sm-12 col-md-5">
              <div class="text-md-end float-md-end s pagination-rounded">

                <!-- <ngb-pagination [collectionSize]="(total$ | async) || 0" [(page)]="service.page" [pageSize]="service.pageSize" >
                </ngb-pagination> -->
              </div>
            </div>
            <!-- End Pagination -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
